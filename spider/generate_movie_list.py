import pymongo
import math
import numpy as np

np.set_printoptions(suppress=True)
client = pymongo.MongoClient('mongodb://localhost:27017/')
database = client["film"]
collection = database['movie_with_rate_small']
predict = [(3.1285214924494653, 6.7), (5.587786715269225, 5.8), (7.8287879702686425, 7.8), (6.714015766881718, 6.9),
           (6.019356680859859, 6.5), (5.702567255098292, 6.5), (6.537790131208228, 6.3), (6.209374106516776, 6.4),
           (5.254301605586675, 6.5), (6.48964850492624, 7.3), (6.331417094251157, 6.4), (6.623478497076472, 6.9),
           (5.641647142131392, 7.2), (5.641647142131392, 7.2), (6.82191598458904, 6.4), (5.967757203262226, 4.0),
           (5.501212187313627, 7.7), (5.4074984026939426, 6.0), (7.076736361447013, 7.5), (5.8722954988557445, 6.5),
           (6.623478497076472, 6.9), (5.742893991385743, 5.4), (6.623478497076472, 7.1), (6.360563083969753, 6.1),
           (6.623478497076472, 7.0), (5.641647142131392, 5.3), (5.846982463170781, 7.1), (5.641647142131392, 6.9),
           (6.59958491004088, 5.3), (6.6798530516108, 6.9), (5.454349446715621, 6.8), (7.12259551860088, 8.0),
           (6.760573391771152, 6.5), (6.622819336198524, 6.1), (5.779525622486187, 5.9), (6.3172399946148445, 6.6),
           (7.2968068879524415, 6.8), (5.778964075632988, 6.4), (7.093951779254538, 7.0), (6.234978301058559, 5.9),
           (5.5459661570945, 5.7), (6.486450164250206, 5.5), (5.778964075632988, 5.1), (6.464725283995805, 6.9),
           (5.053286437540313, 5.7), (6.651176521603163, 5.4), (6.7493526500697385, 6.1), (6.03752334483768, 7.2),
           (6.402712563851375, 7.4), (5.6184836470779915, 5.4), (6.960283655682747, 8.1), (6.43545457628354, 5.8),
           (5.13804639554025, 7.5), (6.794598366024258, 7.1), (6.398065930636619, 7.2), (6.223739216598504, 6.8),
           (6.218008411715701, 7.4), (5.372561509510382, 5.8), (11.145468951227608, 6.9), (3.4481392027781532, 7.9),
           (5.613782630875834, 5.2), (5.641647142131392, 7.0), (5.684928058387486, 6.7), (5.641647142131392, 5.6),
           (6.687386577373506, 7.7), (5.64220868898459, 6.0), (5.641647142131392, 8.2), (7.213678923100302, 5.8),
           (6.005626581216282, 6.8), (5.694565048510831, 7.1), (6.09981653173659, 6.6), (5.1464835149190415, 6.1),
           (6.6655175834212725, 6.2), (5.641647142131392, 7.3), (5.701811203633184, 6.6), (5.831994258732518, 6.5),
           (9.409206793714217, 7.8), (5.107871016756161, 6.5), (5.641647142131392, 7.4), (6.000433316999031, 6.1),
           (5.7129954886539895, 5.9), (5.82381185729651, 6.2), (5.641647142131392, 4.4), (5.989779057688763, 6.5),
           (5.542607277995112, 5.5), (9.543249310693504, 6.9), (5.5715071895947155, 4.6), (6.107173881087771, 7.4),
           (5.056289278428167, 5.3), (5.746179282120593, 6.3), (5.641647142131392, 6.4), (5.955648750341543, 6.5),
           (5.19699628360054, 4.8), (5.641647142131392, 6.8), (5.92442360097822, 7.5), (5.617464455253886, 6.4),
           (6.9958486682599075, 6.8), (6.374270702471854, 6.4), (5.641647142131392, 6.5), (6.695922592047063, 6.7),
           (5.9359679748643455, 7.1), (5.900613378636278, 6.3), (6.0756872003312905, 5.7), (5.991480058340347, 6.4),
           (5.641647142131392, 6.5), (5.718777325996471, 7.1), (5.800699350006712, 6.5), (6.026501392475451, 7.1),
           (6.6530815582586245, 7.1), (6.524879365128322, 6.4), (5.591147896386281, 6.6), (7.426059981972285, 6.9),
           (6.573403180467476, 6.8), (6.493350174624722, 6.4), (5.989779057688763, 6.9), (7.502699720027411, 7.1),
           (5.433628045845077, 5.9), (5.874371106986629, 7.6), (6.317661745464753, 6.7), (5.835173643384553, 6.3),
           (5.638888875645315, 6.2), (6.359327428986076, 7.1), (7.204292505869048, 6.2), (5.641647142131392, 6.0),
           (6.135809040784548, 6.3), (2.1372671446488716, 3.2), (6.3999154379051335, 7.7), (5.704578424872855, 6.3),
           (5.9741893833949, 6.6), (7.370250245626436, 6.3), (5.641647142131392, 6.6), (5.635419310092672, 6.3),
           (6.398205478533032, 6.3), (5.608003589503209, 6.5), (5.5257053831646346, 6.5), (6.840563667451271, 7.0),
           (5.556990607119884, 6.9), (5.617464455253886, 7.0), (7.308124039817624, 6.1), (6.133265777895978, 8.2),
           (6.418058769890354, 6.5), (5.482281977950889, 6.8), (5.641647142131392, 6.2), (5.596990779759485, 6.5),
           (5.607739334245617, 6.3), (9.280596925157672, 7.7), (6.558385956702169, 6.6), (5.715514604164632, 6.2),
           (5.7844724741741995, 6.6), (6.405176865676499, 7.0), (5.540354722948976, 7.0), (6.623478497076472, 6.7),
           (6.317661745464753, 5.5), (7.384352086019639, 6.8), (6.559450195762116, 7.6), (6.975323577582988, 7.5),
           (6.539559458526061, 7.6), (7.170536975199397, 8.9), (7.1364648461362306, 7.2), (8.31939832718283, 8.9),
           (6.261888682519441, 7.2), (6.586680552585013, 5.4), (6.623478497076472, 6.3), (6.623478497076472, 5.7),
           (6.548983692985534, 6.1), (6.623478497076472, 8.1), (6.623478497076472, 7.5), (7.176408872330088, 7.7),
           (6.575944755136862, 6.9), (6.666759413332566, 7.2), (6.623478497076472, 6.7), (6.797477248433911, 6.4),
           (6.704524474791051, 7.0), (7.074670725452878, 8.9), (6.623478497076472, 6.4), (6.542990826705761, 7.9),
           (5.806565932928175, 6.3), (6.2580132321600646, 6.9), (7.40109538900774, 6.3), (6.623478497076472, 7.5),
           (7.369935373583249, 7.7), (7.347843920123976, 6.5), (6.5788221347045654, 6.9), (6.623478497076472, 7.3),
           (6.817004998329633, 6.6), (6.817004998329633, 6.2), (5.6334567440836825, 7.2), (6.23564810507216, 5.2),
           (7.591954922252883, 7.8), (7.169396194608617, 7.2), (6.623478497076472, 5.8), (6.623478497076472, 6.2),
           (7.4646663431467255, 8.0), (6.623478497076472, 8.0), (6.623478497076472, 6.1), (7.684531176666104, 6.9),
           (6.905987666115356, 7.1), (6.623478497076472, 7.9), (6.349152793347829, 7.4), (6.623478497076472, 7.1),
           (6.052282002008448, 5.4), (4.509957280316819, 6.2), (3.208265798637234, 6.7), (6.623478497076472, 6.6),
           (6.623478497076472, 7.3), (6.704464980177753, 7.1), (6.418669090355263, 6.8), (5.509867245032362, 8.0),
           (5.7190948677552145, 3.0), (6.623478497076472, 7.7), (6.996538223841958, 7.3), (6.623478497076472, 6.7),
           (5.641647142131392, 7.9), (5.702060859541134, 6.2), (5.641647142131392, 6.7), (5.641647142131392, 6.1),
           (5.906646017851447, 6.5), (5.658084351459468, 5.8), (8.869651362117812, 8.6), (6.861424234262087, 8.0),
           (5.641647142131392, 5.7), (5.668638578852291, 7.5), (5.921270667120315, 6.9), (6.403600484055851, 7.3),
           (9.361084595528384, 9.4), (9.361084595528384, 9.6), (9.361084595528384, 9.6), (9.361084595528384, 7.7),
           (6.364108323133098, 6.2), (4.293909287935033, 4.4), (6.468386927159579, 6.4), (5.865663004787437, 7.3),
           (6.990919698750112, 7.3), (7.133816208719488, 6.1), (6.243722317994788, 3.8), (5.641647142131392, 6.0),
           (5.678004621506381, 4.6), (5.9176166337269684, 6.2), (5.362569631691056, 5.0), (5.641647142131392, 6.2),
           (5.182324419242726, 6.2), (5.467912120103684, 5.4), (4.980328752291479, 4.1), (7.770638199671265, 8.3),
           (6.681180480019652, 6.2), (5.554832126894313, 8.2), (7.090778954113438, 5.9), (7.093057391213325, 8.6),
           (6.866303896235785, 8.0), (7.098850586613053, 8.2), (7.213117376247103, 6.5), (6.933685129106704, 8.3),
           (7.97989612109262, 8.3), (6.879436928387581, 7.9), (8.212847067750142, 7.3), (5.520107997283067, 6.7),
           (6.171468389839674, 6.0), (7.051986319175948, 6.4), (6.549575167073919, 6.9), (7.317712306861788, 7.4),
           (5.425281776480748, 6.1), (5.641647142131392, 6.3), (5.628514637401113, 6.8), (5.9740355459886345, 6.6),
           (5.65853028737709, 6.2), (6.8270232574705805, 7.0), (5.934265907446287, 6.2), (5.824295790377634, 6.2),
           (6.9775714230397865, 7.3), (7.923592394383218, 6.9), (6.693714560936562, 6.3), (6.8358059893287875, 7.0),
           (5.9740355459886345, 6.1), (5.81764129671925, 5.2), (4.964519561443156, 6.4), (5.158627861120388, 6.2),
           (6.623478497076472, 8.6), (6.840255137892409, 6.0), (6.854646611797551, 6.5), (6.904801143607365, 6.2),
           (5.9400633957682905, 7.0), (6.08976237850777, 6.9), (6.934033116382591, 6.8), (6.760795430578068, 7.3),
           (5.898713854747582, 5.8), (5.440996022389374, 6.6), (5.641647142131392, 7.3), (5.29003573192128, 6.3),
           (5.885404775760869, 6.2), (5.919012763034888, 6.1), (5.631243975145087, 4.9), (6.840768286166373, 7.4),
           (6.030949794224549, 7.2), (5.60372097883997, 7.7), (5.43422887387905, 7.2), (5.746242072746076, 4.8),
           (6.380193283475727, 5.7), (5.510259151012602, 6.8), (5.557219305910333, 7.3), (5.641647142131392, 7.8),
           (6.005626581216282, 6.2), (5.641647142131392, 6.9), (6.5655774646246545, 6.7), (6.007587210609676, 4.0),
           (6.667161367201046, 7.0), (6.127203270191903, 6.5), (5.703851422248314, 5.9), (5.895557927321255, 7.0),
           (5.591571825522396, 5.8), (6.511188246717914, 7.1), (5.852586610088783, 6.6), (7.464702063665973, 6.3),
           (6.030212715345343, 6.7), (6.412862651203131, 4.7), (9.361084595528384, 9.5), (5.641647142131392, 4.3),
           (6.224591393719067, 6.6), (6.707908233919035, 5.6), (5.641647142131392, 5.9), (5.650891201935874, 6.8),
           (5.719243119735607, 6.2), (5.733950755969515, 5.5), (5.361530016574091, 6.2), (5.873565095075557, 6.9),
           (5.641647142131392, 5.7), (5.874371106986629, 6.1), (6.323468924773554, 5.3), (5.922969788662285, 6.2),
           (6.772947839815266, 7.4), (6.892181905818734, 6.6), (6.616021942689338, 7.9), (4.51097954816002, 6.3),
           (6.623478497076472, 8.5), (6.750023540516772, 8.1), (6.745801016252967, 6.3), (4.566952626890223, 6.4),
           (6.623478497076472, 7.0), (7.262250621786512, 7.9), (6.016807679012577, 6.6), (3.1781301030830957, 7.9),
           (6.367176973354418, 6.8), (6.304476868376703, 5.7), (6.424197500084566, 6.4), (7.323699592571613, 5.5),
           (6.365313958476238, 7.1), (6.518809781161101, 7.6), (6.4530057290838005, 6.3), (7.4717738167566035, 7.6),
           (6.359552898010857, 6.2), (6.630066713914597, 6.0), (6.918843441502986, 7.8), (7.186835771653935, 7.4),
           (8.82959855791297, 8.5), (6.8763108669529975, 8.2), (9.361084595528384, 9.4), (9.361084595528384, 9.3),
           (6.63788925394209, 6.1), (5.705771042974743, 5.8), (6.760795430578068, 8.2), (6.3441535876471296, 7.3),
           (7.1314049244748094, 6.1), (6.434044159457552, 6.9), (4.51097954816002, 7.3), (7.0462976670953825, 5.6),
           (5.681285930191464, 6.0), (6.7786159325901405, 7.4), (6.698881157594755, 6.2), (5.982476861153152, 5.9),
           (7.0128064160031816, 7.4), (6.644213415728942, 6.4), (6.623478497076472, 6.4), (5.293250679351532, 6.6),
           (5.771222362036603, 6.0), (5.641647142131392, 6.5), (5.563007657880344, 7.6), (7.161212697408493, 7.7),
           (7.595844865713363, 6.1), (6.333781169222739, 6.6), (6.623478497076472, 7.3), (6.488440062432444, 6.3),
           (5.669212480869003, 6.8), (6.865315106370391, 7.0), (5.912502399328599, 6.9), (3.136263206045853, 6.8),
           (8.608496237795263, 7.5), (6.348161648227023, 6.6), (7.186810516536697, 6.2), (5.820971470393128, 8.2),
           (6.07822748404963, 6.4), (6.1225163291834654, 6.3), (5.641647142131392, 4.7), (5.870985327889632, 6.5),
           (6.476207123536776, 6.8), (5.650336017077297, 5.5), (6.738259268248446, 7.4), (6.015200195600606, 7.2),
           (6.128993229257561, 6.0), (5.676726506285329, 6.4), (5.641647142131392, 6.7), (5.641647142131392, 6.1),
           (6.024925316608875, 5.9), (6.37086906895281, 7.3), (6.746628848179595, 6.7), (5.596990779759485, 5.4),
           (6.976391774040722, 6.5), (5.42241430385915, 6.8), (4.011144945903804, 6.5), (5.65853028737709, 6.3),
           (5.7287611117503605, 5.7), (6.799419348770443, 7.8), (5.4074984026939426, 5.5), (7.111055783519072, 7.2),
           (5.780753403172715, 5.4), (5.363859373848387, 7.0), (6.372965038573756, 5.8), (5.988823463995398, 7.2),
           (6.478150972599313, 6.0), (5.708238508519748, 6.3), (5.498834715919766, 5.6), (5.766715493079148, 5.1),
           (6.220878790172236, 7.1), (6.78875253348354, 7.1), (5.812180107987935, 6.3), (6.939540393938309, 7.7),
           (6.0745115981653415, 6.3), (5.693859220056865, 6.7), (5.86496014454491, 6.6), (5.372963913120017, 7.5),
           (6.771668884435194, 8.5), (6.849913237584815, 7.3), (6.993590506782716, 7.9), (6.065811306390052, 6.4),
           (6.7080693763346195, 6.6), (6.793681110797949, 6.2), (6.898880315637839, 6.6), (6.786224445063551, 7.0),
           (6.623478497076472, 5.4), (6.49240602530399, 7.0), (6.64036164232217, 7.4), (5.889143182885274, 6.2),
           (6.918843441502986, 7.9), (5.804083227211439, 6.3), (5.659166710041492, 6.7), (5.826158347480736, 6.5),
           (5.714707077013234, 8.4), (6.211769848334456, 7.5), (9.361084595528384, 9.3), (3.817822254416101, 3.9),
           (6.6380318299359455, 7.5), (7.374606811098356, 7.2), (6.78383457574474, 5.6), (6.623478497076472, 7.4),
           (5.21052782803997, 6.3), (8.861431360680271, 6.3), (5.618632081511262, 4.0), (6.377392309678902, 5.3),
           (5.914053363076168, 6.6), (5.815259134335551, 5.7), (6.7036766346815275, 7.6), (6.310000103652254, 4.3),
           (7.5067408307680665, 7.8), (6.299960045827501, 8.4), (6.299960045827501, 6.3), (7.295332978192711, 7.5),
           (4.51097954816002, 4.7), (6.729957258233669, 7.4), (6.802471958972744, 7.5), (7.0935034551002865, 7.6),
           (5.702060859541134, 6.1), (6.623478497076472, 8.7), (5.684928058387486, 7.6), (6.646556538055726, 7.6),
           (9.361084595528384, 9.5), (4.836847645471916, 6.0), (6.512942169545629, 6.0), (6.310614669373562, 6.3),
           (5.171308157319744, 6.1), (5.641647142131392, 6.3), (6.672774306401223, 7.4), (5.86496014454491, 6.3),
           (6.905680216300172, 7.8), (6.904801143607365, 7.1), (7.564871956899127, 8.5), (6.623478497076472, 5.5),
           (6.899483171516552, 6.1), (7.161212697408493, 6.4), (6.623478497076472, 6.7), (6.3976033569227635, 6.7),
           (5.182324419242726, 5.3), (5.828064752817923, 6.3), (5.627544490973447, 5.6), (9.759812008923824, 7.5),
           (5.781060682466343, 5.7), (7.044954735157432, 6.8), (6.623478497076472, 7.3)]

index = 0
cnt = 1
m_dic = {}
with open('rate_predict_list.txt', 'a+') as w:
    for m in collection.find({}):
        if cnt > 1156:
            r = predict[index][1]
            p = predict[index][0]
            key = (1 - math.fabs((p - r) / (p + r))) * 100
            a = str(round(key, 2)) + '%'
            t = m['title']
            r = str(round(r, 1))
            p = str(round(p, 2))
            while len(t) < 13:
                t = t + '　'
            while len(r) < 5:
                r = r + '　'
            while len(p) < 5:
                p = p + ' '
            s = t + '\treal: ' + r + '\tpredict: ' + p + '\taccuracy: ' + a + '\n'
            m_dic[key] = s
            index += 1
        cnt += 1
    for k in sorted(m_dic, reverse=True):
        w.write(m_dic[k])
